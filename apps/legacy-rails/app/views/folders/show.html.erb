<% @submenu_title = Folder.model_name.human(count: 2).capitalize; @submenu_item = 'folders'; @action_for_search = search_folders_path(query: params[:query], responsible: params[:responsible], order: params[:order], b: params[:b], c: params[:c]) %>

<div class="inner-section col-lg-10 col-lg-offset-1 col-md-10 col-md-offset-2 col-sm-9 col-sm-offset-2 folders <%= 'list-mode' if cookies[:list_mode] %>">

  <div class="nav-filter-pagination">
    <div class="visible-xs left-navigation">
      <%= link_to (@folder.father || folders_path) do %>
        <i class="fa fa-arrow-left"></i>
      <% end %>
      <%= @folder.name %>
    </div>
  </div>

  <div class="cm-nav-links">
    <%= link_to Folder.model_name.human(count: 2).capitalize, folders_path, class: 'active' %>
    <% if can? :manage, @folder %>
      <div class="dropdown pull-right">
        <button class="btn btn-primary dropdown-toggle" data-toggle="dropdown">
          + <%= t 'general.create_record', record_name: t('folders.files') %>
        </button>
        <ul class="dropdown-menu">
          <li>
            <%= link_to '#', data: { toggle: 'modal', target: '#new-folder-modal' } do %>
              <i class="fa fa-folder"></i>
              <%= t 'folders.new_item_menu.new_folder' %>
            <% end %>
          </li>
          <li>
            <%= link_to '#', class: 'add-attachments-folder-button' do %>
              <i class="fa fa-upload"></i>
              <%= t 'folders.new_item_menu.upload_files' %>
            <% end %>
          </li>
        </ul>
      </div>
    <% end %>

  </div>

  <div class="under-tabs path-container hidden-xs">
    <div class="path">
      <%= folder_tree_path @folder %>
    </div>
    <div class="actions">
      <div id="dynamic-actions">
        <% if can? :manage, @folder %>
          <%= link_to '#', data: {toggle: 'modal', target: '' }, class: 'edit' do %>
            <i class="fa fa-pencil-square-o"></i>
          <% end %>
        <% end %>
        <% if can? :read, @folder %>
          <%= link_to '', download: '', class: 'download' do %>
            <i class="fa fa-download"></i>
          <% end %>
        <% end %>
        <% if can? :manage, @folder %>
          <%= confirm_destroy '', remote: true do %>
            <i class="fa fa-trash-o"></i>
          <% end %>
        <% end %>
      </div>
      <%= link_to '#', class: 'change-folder-mode' do %>
        <i class="fa fa-list" <%= cm_popover '', t('folders.link_description.list') %>></i>
        <i class="fa fa-th-large" <%= cm_popover '', t('folders.link_description.icons') %>></i>
      <% end %>
    </div>
    <%= render 'shared/order_by_button', btn_text: 'AZ ' %>
  </div>

  <div class="col-xs-12 documents-container">
    <div class="row">
      <%= render 'list_header' %>
      <div class="folders-container clearfix" id="documents">
        <%= render @sub_folders %>
      </div>
      <div class="attachments-container load-more-at-bottom" data-next-path="<%= @next_path %>">
        <%= render partial: 'attachment', collection: @attachments %>
      </div>
    </div>
  </div>
</div>

<% if can? :manage, @folder %>
  <div class="modal fade form-new-object" id="new-folder-modal">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
          <h4 class="modal-title"><%= t 'folders.new_item_menu.new_folder' %></h4>
        </div>
        <div class="modal-body">
          <%= form_for Folder.new, remote: true do |f| %>
            <div class="new-folder-errors-container"></div>
            <%= f.hidden_field :father_id, value: @folder.id %>
            <div class="form-group emoji-picker-container normal-height">
              <%= f.text_field :name, class: 'form-control', placeholder: t('folders.folder_name'), data: { emojiable: true } %>
            </div>
            <div class="clearfix">
              <%= f.submit t('general.create'), class: 'btn btn-primary pull-right' %>
            </div>
          <% end %>
        </div>
      </div>
    </div>
  </div>
  <div class="hidden">
    <%= form_for :attachment, url: folder_add_attachments_path(@folder),
      html: {id: 'add-attachments-folder', remote: true, multipart: true} do |f|
    %>
      <%= f.file_field :file_attachments, accept: Attachment.all_extensions_to_s, multiple: true,
        data: { max_files: Attachment::MAX_FILES, max_file_size: Attachment::MAX_FILE_SIZE,
          max_files_error: t('folders.errors.limit_files',  number: Attachment::MAX_FILES),
          max_file_size_error: t('folders.errors.file_size_less_than',  size: Attachment::MAX_FILE_SIZE_HUMAN)
        }
      %>
    <% end %>
  </div>
  <%= render 'shared/modal_spinner' %>
<% end %>
