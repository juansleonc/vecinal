<% @submenu_title = t('general.submenu.communities'); @submenu_item = 'communities'; geolocation = request.location.data.symbolize_keys %>

<div class="inner-section col-lg-10 col-lg-offset-1 col-md-10 col-md-offset-2 col-sm-9 col-sm-offset-2 finish-registration-communities">
  <%= render 'finish_registration/communities_header', modal_target: '#new-business-modal' %>

  <div class="under-tabs clearfix <%= 'requested' if current_user.accountable.present? %>">
    <div class="col-xs-12 colored-banner red-bg">
      <i class="fa fa-exclamation-triangle"></i> <%= t('finish_registration.pending_access_request') %>
    </div>
    <div class="col-xs-12 colored-banner yellow-bg">
      <i class="fa fa-exclamation-triangle"></i> Join your building. If is not listed,
      <%= link_to t('finish_registration.click_here'), '#', data: { toggle: 'modal', target: "#new-#{@community_type}-modal" } %>
      and ask your building to create it!
    </div>
  </div>

  <%= form_for current_user, url: finish_registration_set_role_path, method: :put, remote: true do |f| %>
    <%= f.hidden_field :accountable_type, value: 'Business' %>
    <%= f.hidden_field :accountable_code %>
    <div class="cm-gallery-grid clearfix" id="communities">
      <%= render partial: 'finish_registration/community', collection: @communities %>
    </div>
  <% end %>
</div>

<div class="modal fade form-new-object" id="new-business-modal">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
        <h4 class="modal-title"><%= t 'general.create_record', record_name: Business.model_name.human.capitalize %></h4>
      </div>
      <div class="modal-body">
        <%= condomedia_form_for current_user.build_business, url: finish_registration_create_community_path, remote: true do |f| %>
          <%= f.hidden_field :namespace %>
          <div class="errors-container"></div>
          <div class="form-group">
            <%= f.text_field :name, class: 'form-control', placeholder: 'Name' %>
          </div>
          <div class="form-group">
            <%= f.text_field :address, class: 'form-control', placeholder: 'Street address' %>
          </div>
          <div class="form-group">
            <%= f.text_field :city, value: geolocation[:city], class: 'form-control' %>
          </div>
          <div class="form-group">
            <%= f.text_field :zip, value: geolocation[:zipcode], class: 'form-control', placeholder: 'Zip/Postal code (optional)' %>
          </div>
          <div class="form-group">
            <%= f.text_field :region, value: geolocation[:region_name], class: 'form-control' %>
          </div>
          <div class="form-group">
            <%= f.text_field :country, value: geolocation[:country_name], class: 'form-control' %>
          </div>
          <div class="form-group">
            <%= f.text_field :phone, class: 'form-control' %>
          </div>
          <div class="form-group">
            By clicking Next, you agree to Condo Media Privacy Policy, Terms and conditions
          </div>
          <%= f.submit t('general.save'), class: 'btn btn-primary' %>
          <button type="button" class="btn btn-default" data-dismiss="modal"><%= t 'general.cancel' %></button>
        <% end %>
      </div>
    </div>
  </div>
</div>
